{"ast":null,"code":"\"use client\";\n\nvar _jsxFileName = \"/home/dhpho/Programming/NCKH/admin-web/src/CallStaffNotificationFixed.js\",\n  _s = $RefreshSig$();\nimport { useState, useEffect } from \"react\";\nimport \"./CallStaffNotification.css\";\nimport { jsxDEV as _jsxDEV } from \"react/jsx-dev-runtime\";\nconst CallStaffNotification = () => {\n  _s();\n  const [callStaffs, setCallStaffs] = useState([]);\n  const [isVisible, setIsVisible] = useState(true);\n\n  // Hàm để lấy dữ liệu từ API\n  const fetchCallStaffs = async () => {\n    try {\n      console.log(\"Đang gọi API get-call-staffs...\");\n\n      // Để test, sử dụng dữ liệu mẫu thay vì gọi API\n      const testData = [{\n        CallStaffID: 1,\n        TableID: 101,\n        Status: \"waiting\",\n        CreatedAt: \"2025-05-17T22:02:42.293Z\"\n      }, {\n        CallStaffID: 2,\n        TableID: 201,\n        Status: \"waiting\",\n        CreatedAt: \"2025-05-17T22:20:10.867Z\"\n      }, {\n        CallStaffID: 3,\n        TableID: 202,\n        Status: \"waiting\",\n        CreatedAt: \"2025-05-17T22:21:01.033Z\"\n      }];\n\n      // Sử dụng dữ liệu mẫu để test\n      setCallStaffs(testData);\n      console.log(\"Đã cập nhật dữ liệu:\", testData);\n\n      //   const response = await fetch(\"http://localhost/api/users/get-call-staffs\", {\n      //     method: \"GET\",\n      //     headers: {\n      //       \"Content-Type\": \"application/json\",\n      //     },\n      //   })\n      //   if (response.ok) {\n      //     const data = await response.json()\n      //     console.log(\"Dữ liệu nhận được:\", data)\n      //     setCallStaffs(data)\n      //   } else {\n      //     console.error(\"Lỗi khi lấy dữ liệu:\", response.statusText)\n      //   }\n    } catch (error) {\n      console.error(\"Lỗi khi gọi API:\", error);\n    }\n  };\n\n  // Hàm để cập nhật trạng thái của một callStaff\n  const updateCallStaff = async callStaffId => {\n    try {\n      console.log(\"Đang cập nhật callStaffId:\", callStaffId);\n\n      // Cập nhật UI trước khi gọi API để tăng trải nghiệm người dùng\n      setCallStaffs(callStaffs.filter(staff => staff.CallStaffID !== callStaffId));\n      const response = await fetch(\"http://localhost/api/users/update-call-staff\", {\n        method: \"POST\",\n        headers: {\n          \"Content-Type\": \"application/json\"\n        },\n        body: JSON.stringify({\n          callStaffId\n        })\n      });\n      if (!response.ok) {\n        console.error(\"Lỗi khi cập nhật:\", response.statusText);\n        // Nếu API lỗi, có thể cần lấy lại dữ liệu\n        fetchCallStaffs();\n      }\n    } catch (error) {\n      console.error(\"Lỗi khi gọi API cập nhật:\", error);\n      // Nếu có lỗi, lấy lại dữ liệu\n      fetchCallStaffs();\n    }\n  };\n\n  // Sử dụng useEffect để gọi API định kỳ\n  useEffect(() => {\n    console.log(\"Component đã mount, gọi API lần đầu\");\n    // Gọi lần đầu khi component được mount\n    fetchCallStaffs();\n\n    // Thiết lập interval để gọi API mỗi 10 giây\n    const intervalId = setInterval(() => {\n      console.log(\"Đang gọi API định kỳ...\");\n      fetchCallStaffs();\n    }, 10000);\n\n    // Dọn dẹp interval khi component unmount\n    return () => {\n      console.log(\"Component unmount, xóa interval\");\n      clearInterval(intervalId);\n    };\n  }, []);\n  console.log(\"Rendering component với\", callStaffs.length, \"thông báo\");\n  console.log(\"isVisible:\", isVisible);\n\n  // Luôn hiển thị khi có dữ liệu, bất kể isVisible\n  if (callStaffs.length === 0) {\n    console.log(\"Không có thông báo, không hiển thị gì\");\n    return null;\n  }\n  return /*#__PURE__*/_jsxDEV(\"div\", {\n    className: \"call-staff-notification\",\n    style: {\n      display: \"block\"\n    },\n    children: [/*#__PURE__*/_jsxDEV(\"div\", {\n      className: \"notification-header\",\n      children: [/*#__PURE__*/_jsxDEV(\"h3\", {\n        children: [\"Th\\xF4ng b\\xE1o g\\u1ECDi nh\\xE2n vi\\xEAn (\", callStaffs.length, \")\"]\n      }, void 0, true, {\n        fileName: _jsxFileName,\n        lineNumber: 118,\n        columnNumber: 9\n      }, this), /*#__PURE__*/_jsxDEV(\"button\", {\n        className: \"close-button\",\n        onClick: () => setIsVisible(false),\n        children: \"\\xD7\"\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 119,\n        columnNumber: 9\n      }, this)]\n    }, void 0, true, {\n      fileName: _jsxFileName,\n      lineNumber: 117,\n      columnNumber: 7\n    }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n      className: \"notification-content\",\n      children: callStaffs.map(staff => /*#__PURE__*/_jsxDEV(\"div\", {\n        className: \"notification-item\",\n        children: [/*#__PURE__*/_jsxDEV(\"div\", {\n          className: \"notification-info\",\n          children: [/*#__PURE__*/_jsxDEV(\"p\", {\n            children: [/*#__PURE__*/_jsxDEV(\"strong\", {\n              children: \"B\\xE0n:\"\n            }, void 0, false, {\n              fileName: _jsxFileName,\n              lineNumber: 128,\n              columnNumber: 17\n            }, this), \" \", staff.TableID]\n          }, void 0, true, {\n            fileName: _jsxFileName,\n            lineNumber: 127,\n            columnNumber: 15\n          }, this), /*#__PURE__*/_jsxDEV(\"p\", {\n            children: [/*#__PURE__*/_jsxDEV(\"strong\", {\n              children: \"Tr\\u1EA1ng th\\xE1i:\"\n            }, void 0, false, {\n              fileName: _jsxFileName,\n              lineNumber: 131,\n              columnNumber: 17\n            }, this), \" \", staff.Status]\n          }, void 0, true, {\n            fileName: _jsxFileName,\n            lineNumber: 130,\n            columnNumber: 15\n          }, this), /*#__PURE__*/_jsxDEV(\"p\", {\n            children: [/*#__PURE__*/_jsxDEV(\"strong\", {\n              children: \"Th\\u1EDDi gian:\"\n            }, void 0, false, {\n              fileName: _jsxFileName,\n              lineNumber: 134,\n              columnNumber: 17\n            }, this), \" \", new Date(staff.CreatedAt).toLocaleTimeString()]\n          }, void 0, true, {\n            fileName: _jsxFileName,\n            lineNumber: 133,\n            columnNumber: 15\n          }, this)]\n        }, void 0, true, {\n          fileName: _jsxFileName,\n          lineNumber: 126,\n          columnNumber: 13\n        }, this), /*#__PURE__*/_jsxDEV(\"button\", {\n          className: \"complete-button\",\n          onClick: () => updateCallStaff(staff.CallStaffID),\n          children: \"\\u0110\\xE3 x\\u1EED l\\xFD\"\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 137,\n          columnNumber: 13\n        }, this)]\n      }, staff.CallStaffID, true, {\n        fileName: _jsxFileName,\n        lineNumber: 125,\n        columnNumber: 11\n      }, this))\n    }, void 0, false, {\n      fileName: _jsxFileName,\n      lineNumber: 123,\n      columnNumber: 7\n    }, this)]\n  }, void 0, true, {\n    fileName: _jsxFileName,\n    lineNumber: 116,\n    columnNumber: 5\n  }, this);\n};\n_s(CallStaffNotification, \"a7CjGFIhqeSfCKze+9MR6Ont0Gc=\");\n_c = CallStaffNotification;\nexport default CallStaffNotification;\nvar _c;\n$RefreshReg$(_c, \"CallStaffNotification\");","map":{"version":3,"names":["_jsxFileName","_s","$RefreshSig$","useState","useEffect","jsxDEV","_jsxDEV","CallStaffNotification","callStaffs","setCallStaffs","isVisible","setIsVisible","fetchCallStaffs","console","log","testData","CallStaffID","TableID","Status","CreatedAt","error","updateCallStaff","callStaffId","filter","staff","response","fetch","method","headers","body","JSON","stringify","ok","statusText","intervalId","setInterval","clearInterval","length","className","style","display","children","fileName","lineNumber","columnNumber","onClick","map","Date","toLocaleTimeString","_c","$RefreshReg$"],"sources":["/home/dhpho/Programming/NCKH/admin-web/src/CallStaffNotificationFixed.js"],"sourcesContent":["\"use client\"\n\nimport { useState, useEffect } from \"react\"\nimport \"./CallStaffNotification.css\"\n\nconst CallStaffNotification = () => {\n  const [callStaffs, setCallStaffs] = useState([])\n  const [isVisible, setIsVisible] = useState(true)\n\n  // Hàm để lấy dữ liệu từ API\n  const fetchCallStaffs = async () => {\n    try {\n      console.log(\"Đang gọi API get-call-staffs...\")\n\n      // Để test, sử dụng dữ liệu mẫu thay vì gọi API\n      const testData = [\n        {\n          CallStaffID: 1,\n          TableID: 101,\n          Status: \"waiting\",\n          CreatedAt: \"2025-05-17T22:02:42.293Z\",\n        },\n        {\n          CallStaffID: 2,\n          TableID: 201,\n          Status: \"waiting\",\n          CreatedAt: \"2025-05-17T22:20:10.867Z\",\n        },\n        {\n          CallStaffID: 3,\n          TableID: 202,\n          Status: \"waiting\",\n          CreatedAt: \"2025-05-17T22:21:01.033Z\",\n        },\n      ]\n\n      // Sử dụng dữ liệu mẫu để test\n      setCallStaffs(testData)\n      console.log(\"Đã cập nhật dữ liệu:\", testData)\n\n    //   const response = await fetch(\"http://localhost/api/users/get-call-staffs\", {\n    //     method: \"GET\",\n    //     headers: {\n    //       \"Content-Type\": \"application/json\",\n    //     },\n    //   })\n    //   if (response.ok) {\n    //     const data = await response.json()\n    //     console.log(\"Dữ liệu nhận được:\", data)\n    //     setCallStaffs(data)\n    //   } else {\n    //     console.error(\"Lỗi khi lấy dữ liệu:\", response.statusText)\n    //   }\n    } catch (error) {\n      console.error(\"Lỗi khi gọi API:\", error)\n    }\n  }\n\n  // Hàm để cập nhật trạng thái của một callStaff\n  const updateCallStaff = async (callStaffId) => {\n    try {\n      console.log(\"Đang cập nhật callStaffId:\", callStaffId)\n\n      // Cập nhật UI trước khi gọi API để tăng trải nghiệm người dùng\n      setCallStaffs(callStaffs.filter((staff) => staff.CallStaffID !== callStaffId))\n\n      const response = await fetch(\"http://localhost/api/users/update-call-staff\", {\n        method: \"POST\",\n        headers: {\n          \"Content-Type\": \"application/json\",\n        },\n        body: JSON.stringify({ callStaffId }),\n      })\n\n      if (!response.ok) {\n        console.error(\"Lỗi khi cập nhật:\", response.statusText)\n        // Nếu API lỗi, có thể cần lấy lại dữ liệu\n        fetchCallStaffs()\n      }\n    } catch (error) {\n      console.error(\"Lỗi khi gọi API cập nhật:\", error)\n      // Nếu có lỗi, lấy lại dữ liệu\n      fetchCallStaffs()\n    }\n  }\n\n  // Sử dụng useEffect để gọi API định kỳ\n  useEffect(() => {\n    console.log(\"Component đã mount, gọi API lần đầu\")\n    // Gọi lần đầu khi component được mount\n    fetchCallStaffs()\n\n    // Thiết lập interval để gọi API mỗi 10 giây\n    const intervalId = setInterval(() => {\n      console.log(\"Đang gọi API định kỳ...\")\n      fetchCallStaffs()\n    }, 10000)\n\n    // Dọn dẹp interval khi component unmount\n    return () => {\n      console.log(\"Component unmount, xóa interval\")\n      clearInterval(intervalId)\n    }\n  }, [])\n\n  console.log(\"Rendering component với\", callStaffs.length, \"thông báo\")\n  console.log(\"isVisible:\", isVisible)\n\n  // Luôn hiển thị khi có dữ liệu, bất kể isVisible\n  if (callStaffs.length === 0) {\n    console.log(\"Không có thông báo, không hiển thị gì\")\n    return null\n  }\n\n  return (\n    <div className=\"call-staff-notification\" style={{ display: \"block\" }}>\n      <div className=\"notification-header\">\n        <h3>Thông báo gọi nhân viên ({callStaffs.length})</h3>\n        <button className=\"close-button\" onClick={() => setIsVisible(false)}>\n          ×\n        </button>\n      </div>\n      <div className=\"notification-content\">\n        {callStaffs.map((staff) => (\n          <div key={staff.CallStaffID} className=\"notification-item\">\n            <div className=\"notification-info\">\n              <p>\n                <strong>Bàn:</strong> {staff.TableID}\n              </p>\n              <p>\n                <strong>Trạng thái:</strong> {staff.Status}\n              </p>\n              <p>\n                <strong>Thời gian:</strong> {new Date(staff.CreatedAt).toLocaleTimeString()}\n              </p>\n            </div>\n            <button className=\"complete-button\" onClick={() => updateCallStaff(staff.CallStaffID)}>\n              Đã xử lý\n            </button>\n          </div>\n        ))}\n      </div>\n    </div>\n  )\n}\n\nexport default CallStaffNotification\n"],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}